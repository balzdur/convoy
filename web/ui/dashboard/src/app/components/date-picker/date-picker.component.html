<div convoyOverlay *ngIf="showPicker" (click)="showPicker = false"></div>
<div class="relative">
	<button convoy-button [fill]="!selectedDates?.startDate && !selectedDates?.endDate ? 'outline' : 'soft'" texture="light" (click)="showPicker = !showPicker" class="justify-between py-8px px-16px w-128px">
		<div class="flex">
			<img src="/assets/img/calendar-icon.svg" class="w-16px mr-10px" *ngIf="formType === 'filter'" />
			<span class="text-gray-500 mr-4px">{{ formType === 'input' && selectedDates?.startDate ? formatDate(selectedStartDay) : 'Date' }}</span>
		</div>

		<button type="button" *ngIf="selectedDates?.startDate && selectedDates?.endDate" (click)="clearDate($event); clearDates.emit()">
			<svg width="10" height="10" class="fill-primary-100">
				<use xlink:href="#close-icon"></use>
			</svg>
		</button>
		<img src="/assets/img/angle-arrow-down.svg" class="ml-16px mr-0px w-14px" alt="arrow down icon" *ngIf="!selectedDates?.startDate && !selectedDates?.endDate && formType === 'filter'" />
	</button>

	<div convoy-dropdown-container position="left" size="xl" class="p-10px !overflow-hidden" [show]="showPicker">
		<div class="w-full">
			<div class="date-picker">
				<div class="inputs flex items-center w-full justify-between bg-white-100 py-10px mb-10px">
					<div class="flex items-center py-4px px-10px bg-white-100 border border-primary-50 focus-within:border-primary-200 transition-all duration-300 ease-in-out rounded-8px" [ngClass]="{ 'w-full': formType === 'input' }">
						<span *ngIf="formType === 'filter'" class="text-14 text-gray-600 font-light">Start:</span>
						<input placeholder="dd" pattern="[0-9]*" maxlength="2" max="31" class="w-24px outline-none rounded-tl-8px rounded-bl-8px text-center text-14 text-gray-400 font-light" [(ngModel)]="startDate.day" (change)="onInputStartDate()" />
						<span class="text-10 text-gray-400">/</span>
						<input placeholder="mm" pattern="[0-9]*" maxlength="2" max="12" class="w-32px outline-none text-center text-14 text-gray-400 font-light" [(ngModel)]="startDate.month" (change)="onInputStartDate()" />
						<span class="text-10 text-gray-400">/</span>
						<input placeholder="yyyy" pattern="[0-9]*" maxlength="4" class="w-44px outline-none rounded-tr-8px rounded-br-8px text-center text-14 text-gray-400 font-light" [(ngModel)]="startDate.year" (change)="onInputStartDate()" />
					</div>

					<div *ngIf="formType === 'filter'" class="start-date flex items-center py-4px px-10px bg-white-100 border border-primary-50 focus-within:border-primary-200 transition-all duration-300 ease-in-out rounded-8px">
						<span class="text-14 text-gray-600 font-light">End:</span>
						<input placeholder="dd" pattern="[0-9]*" maxlength="2" max="31" class="w-24px outline-none rounded-tl-8px rounded-bl-8px text-center text-14 text-gray-400 font-light" [(ngModel)]="endDate.day" (change)="onInputEndDate()" />
						<span class="text-10 text-gray-400">/</span>
						<input placeholder="mm" pattern="[0-9]*" maxlength="2" max="12" class="w-32px outline-none text-center text-14 text-gray-400 font-light" [(ngModel)]="endDate.month" (change)="onInputEndDate()" />
						<span class="text-10 text-gray-400">/</span>
						<input placeholder="yyyy" pattern="[0-9]*" maxlength="4" class="w-36px outline-none rounded-tr-8px rounded-br-8px text-center text-14 text-gray-400 font-light" [(ngModel)]="endDate.year" (change)="onInputEndDate()" />
					</div>
				</div>

				<div class="calendar">
					<div class="calendar-nav flex items-center justify-between">
						<div class="flex items-center">
							<button type="button" (click)="setYear(-1)">
								<svg width="24" height="24" class="fill-gray-500">
									<use xlink:href="#double-arrow-left-icon"></use>
								</svg>
							</button>
							<button type="button" (click)="setMonth(-1)">
								<svg width="24" height="24" class="fill-gray-500">
									<use xlink:href="#arrow-left-icon"></use>
								</svg>
							</button>
						</div>

						<div class="text-center py-4px px-10px text-14 font-semibold bg-primary-25 text-gray-600 rounded-4px">{{ monthMap[month] }} {{ year }}</div>

						<div class="flex items-center">
							<button type="button" (click)="setMonth(1)">
								<svg width="24" height="24" class="fill-gray-500">
									<use xlink:href="#arrow-right-icon"></use>
								</svg>
							</button>
							<button type="button" (click)="setYear(1)">
								<svg width="24" height="24" class="fill-gray-500">
									<use xlink:href="#double-arrow-right-icon"></use>
								</svg>
							</button>
						</div>
					</div>

					<div class="week bg-primary-25 grid grid-cols-7 py-8px capitalize items-center text-center mt-20px">
						<div class="text-14">S</div>
						<div class="text-14">M</div>
						<div class="text-14">T</div>
						<div class="text-14">W</div>
						<div class="text-14">T</div>
						<div class="text-14">F</div>
						<div class="text-14">S</div>
					</div>

					<div class="days grid grid-cols-7 text-center mt-10px">
						<button size="sm" fill="ghost" spacing="false" type="button" color="grey" class="!text-14" [class]="getDayClassNames(date)" *ngFor="let date of calendarDate" (click)="onselectDay(date.timestamp)">
							{{ date.date }}
						</button>
					</div>
				</div>
			</div>

			<div class="flex items-center justify-end p-10px">
				<button convoy-button size="sm" type="button" fill="outline" color="danger" class="mr-14px" *ngIf="selectedDates?.startDate && selectedDates?.endDate" (click)="clearDate(); clearDates.emit()">Clear</button>
				<button convoy-button size="sm" type="button" (click)="applyDate()">Apply</button>
			</div>
		</div>
	</div>
</div>
